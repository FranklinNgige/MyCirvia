generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

<<<<<<< ours
enum IdentityLevel {
  ANONYMOUS
  PARTIAL
  FULL
}

enum ScopeType {
  GLOBAL_DEFAULT
  CIRVIA
  CHAT
}

model User {
  id             String          @id @default(cuid())
  email          String          @unique
  profile        Profile?
  identityScopes IdentityScope[]
  memberships    CirviaMember[]
  chatMembers    ChatParticipant[]
}

model Profile {
  id         String  @id @default(cuid())
  userId     String  @unique
  chosenName String?
  realName   String?
  user       User    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model IdentityScope {
  id               String        @id @default(cuid())
  userId           String
  scopeType        ScopeType     @default(GLOBAL_DEFAULT)
  scopeId          String        @default("GLOBAL_DEFAULT")
  identityLevel    IdentityLevel @default(ANONYMOUS)
  showAgeRange     Boolean       @default(false)
  showGender       Boolean       @default(false)
  showProfilePhoto Boolean       @default(false)
  showRealName     Boolean       @default(false)
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, scopeType, scopeId])
  @@index([userId, scopeType, scopeId])
}

model Cirvia {
  id      String         @id @default(cuid())
  name    String
  members CirviaMember[]
}

model CirviaMember {
  id       String @id @default(cuid())
  userId   String
  cirviaId String

  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  cirvia Cirvia @relation(fields: [cirviaId], references: [id], onDelete: Cascade)

  @@unique([userId, cirviaId])
}

model Chat {
  id      String            @id @default(cuid())
  kind    String
  members ChatParticipant[]
}

model ChatParticipant {
  id     String @id @default(cuid())
  userId String
  chatId String

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  chat Chat @relation(fields: [chatId], references: [id], onDelete: Cascade)

  @@unique([userId, chatId])
=======
enum ChatIdentityRevealStatus {
  NONE
  ONE_SIDED_A_TO_B
  ONE_SIDED_B_TO_A
  MUTUAL_PENDING
  MUTUAL_CONFIRMED
  REVOKED_BY_A
  REVOKED_BY_B
  REVOKED_MUTUAL
}

model ChatIdentityReveal {
  id          String                   @id @default(uuid()) @db.Uuid
  chatId      String                   @db.Uuid
  fromUserId  String                   @db.Uuid
  toUserId    String                   @db.Uuid
  status      ChatIdentityRevealStatus @default(NONE)
  initiatedAt DateTime                 @default(now())
  confirmedAt DateTime?
  revokedAt   DateTime?

  @@index([chatId])
  @@unique([chatId, fromUserId, toUserId])
>>>>>>> theirs
}
